<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<%= render template: "layouts/headbar" %>
<div class="container">
  <%= render 'shared/breadcrumb' %>
  <% if flash[:notice] %>
  <div class="alert alert-success">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <%= flash[:notice] %>
  </div>
  <% end %>
  <div class="row">
    <div class="col-xs-12 col-md-12 col-lg-12 text-center">
      <div class="row">
        <div class="col-sm-12 col-md-12"><h3>Movie - Tickets Graph</h3></div>
        <div class="col-sm-12 col-md-12" style="margin-top: -11px;"><small>(Click on bars for more details)</small></div>
        <div class="col-sm-12 col-md-12">
          <div id="chart_div">
            <div class="loading col-sm-12 col-md-12" style="margin-top: 60px;">Loading graph...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 col-md-12 col-lg-12 text-center">
      <div class="row">
        <div class="col-sm-12 col-md-12"><h3>Movies by language</h3></div>
        <div class="col-sm-12 col-md-12" style="margin-top: -11px;"><small>(Click on bars for more details)</small></div>
        <div class="col-sm-12 col-md-12">
          <div id="chart_div">
            <div class="loading col-sm-12 col-md-12" style="margin-top: 60px;">Loading graph...</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $("chart_div").load(function(){
    $(document).find(".loading").remove();
  });
  google.charts.load('current', {packages: ['corechart', 'bar']});
  google.charts.setOnLoadCallback(drawBasic);

  function drawBasic() {

    var data = google.visualization.arrayToDataTable([
    ['Element', 'Tickets', { role: 'style' }],
    <% @count.each do |key| %>
    ['<%= Movie.find(key['_id']).name %>', <%= key['ticket_count'] %>, 'rgb(51, 102, 204)'],
    <% end %>
    ]);

    var chart = new google.visualization.ColumnChart(
    document.getElementById('chart_div'));
    chart.draw(data);
  }
</script>
